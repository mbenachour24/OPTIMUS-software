<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimus - Statistics Dashboard</title>
    <link rel="stylesheet" href="static/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<<<<<<< HEAD
    <script src="https://cdn.jsdelivr.net/npm/simple-statistics@7.8.3/dist/simple-statistics.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.4.4/math.js"></script>
</head>
=======
    <link rel="icon" href="static/favicon.ico" type="image/x-icon">
    
        <!--  MathJax Configuration -->
    <script>
        window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        svg: {
            fontCache: 'global'
            }
        };
    </script>
    
        <!-- Load MathJax -->
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
    
>>>>>>> FastAPIversion
<body>
    <header>Optimus - Statistics Dashboard</header>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <h3>Navigation</h3>
            <ul>
                <li><a href="/">Home</a></li>
<<<<<<< HEAD
            </ul>
            <h3>Systems</h3>
            <ul>
                <li><a href="/judicial">Judicial System</a></li>
                <li><a href="/political">Political System</a></li>
=======
                <li><a href="/judicial">Judicial System</a></li>
                <li><a href="/political">Political System</a></li>
                <li><a href="/view_cases">View Cases</a></li>
                <li><a href="/view_norms">View Norms</a></li>
>>>>>>> FastAPIversion
            </ul>
            <h3>Analytics</h3>
            <ul>
                <li class="has-submenu">
                    <a href="/general_log">General Log</a>
                    <ul class="submenu">
                        <li><a href="/general_log#todays-activities">Today's Activities</a></li>
                        <li><a href="/general_log#norm-updates">Norm Updates</a></li>
                        <li><a href="/general_log#case-decisions">Case Decisions</a></li>
                    </ul>
                </li>
<<<<<<< HEAD
                <li><strong>Statistics Dashboard</strong></li>
=======
                <li><span class="current-page">Statistics Dashboard</span></li>
>>>>>>> FastAPIversion
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <h2>System Statistics</h2>
<<<<<<< HEAD
            
=======

>>>>>>> FastAPIversion
            <!-- Summary Cards -->
            <div class="stats-summary">
                <div class="stat-card">
                    <h3>Cases</h3>
                    <div class="stat-numbers">
                        <p>Pending: <span id="pending-count">0</span></p>
                        <p>Solved: <span id="solved-count">0</span></p>
                        <p>Total: <span id="total-cases">0</span></p>
                    </div>
                </div>
                <div class="stat-card">
                    <h3>Norms</h3>
                    <div class="stat-numbers">
                        <p>Valid: <span id="valid-norms">0</span></p>
                        <p>Invalid: <span id="invalid-norms">0</span></p>
                        <p>Total: <span id="total-norms">0</span></p>
                    </div>
                </div>
                <div class="stat-card">
                    <h3>System Health</h3>
                    <div class="stat-numbers">
<<<<<<< HEAD
                        <p>Case Resolution Rate: <span id="resolution-rate">0%</span></p>
                        <p>Avg Resolution Time: <span id="avg-resolution-time">0h</span></p>
=======
                        <p>Resolution Rate: <span id="resolution-rate">0%</span></p>
>>>>>>> FastAPIversion
                    </div>
                </div>
            </div>

<<<<<<< HEAD
            <!-- Charts Section -->
            <div class="charts-container">
                <div class="chart-box">
                    <h3>Cases by Type</h3>
=======
            <div class="stats-summary">
                <div class="stat-card">
                    <h3>Normative Inflation</h3>
                    <button onclick="openDialog()" class="info-button" aria-label="More Info">ℹ️</button>
                    <div class="stat-numbers">
                        <p>Normative Density: <span id="normative-density">0</span></p>
                        <p>Processing Rate: <span id="processing-rate">0</span></p>
                        <p>Backlog: <span id="backlog">0</span></p>
                        <p>Temporal Gap: <span id="temporal-gap">0</span></p>
                    </div>
                </div>
            </div>

            <!-- Hidden Dialog for Statistical Explanation -->
            <div id="math-dialog" class="dialog" role="dialog" aria-labelledby="dialog-title" aria-describedby="dialog-description">
                <div class="dialog-content">
                    <span class="close-button" onclick="closeDialog()" aria-label="Close">&times;</span>
                    <h2 id="dialog-title">Understanding Normative Inflation</h2>
                    <p id="dialog-description">
                        Normative Inflation refers to the gap between norm creation and judicial processing. If the Normative Density (ND) exceeds the Processing Rate (PR), the Temporal Gap (TG) increases, leading to a judicial overloa, i.e., a backlog of unprocessed norms.
                    </p>
                    <h3>1. Normative Density (ND)</h3>
                    <p>
                        The total number of norms created:
                    </p>
                    <p>
                        \[
                        ND = \sum_{i=1}^{N} 1(i \in \text{Norms})
                        \]
                    </p>

                    <h3>2. Processing Rate (PR)</h3>
                    <p>
                        The total number of norms processed by the judiciary:
                    </p>
                    <p>
                        \[
                        PR = \sum_{j=1}^{M} 1(j \in \text{Cases} \land \text{status}(j) = \text{'solved'})
                        \]
                    </p>

                    <h3>3. Backlog (B_t)</h3>
                    <p>
                        The number of norms that remain unprocessed:
                    </p>
                    <p>
                        \[
                        B_t = \max(0, ND - PR)
                        \]
                    </p>

                    <h3>4. Temporal Gap (TG)</h3>
                    <p>
                        The average delay between norm creation and judicial processing:
                    </p>
                    <p>
                        \[
                        TG = \frac{\sum_{k=1}^{P} (\text{resolved\_at}(k) - \text{created\_at}(k))}{P}
                        \]
                    </p>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-container">
                <div class="chart-box">
                    <h3>Cases Chart</h3>
>>>>>>> FastAPIversion
                    <canvas id="caseTypesChart"></canvas>
                </div>
                <div class="chart-box">
                    <h3>Case Resolution Timeline</h3>
                    <canvas id="resolutionTimelineChart"></canvas>
                </div>
                <div class="chart-box">
<<<<<<< HEAD
                    <h3>System Correlations</h3>
                    <div class="correlation-stats">
                        <p>Norms-Cases Correlation: <span id="norm-case-correlation">Loading...</span></p>
                        <p>Resolution Rate: <span id="resolution-rate-trend">Loading...</span></p>
                    </div>
                </div>
                <div class="chart-box">
                    <h3>System Trends</h3>
                    <canvas id="trendsChart"></canvas>
                </div>
                <div class="chart-box">
                    <h3>System Performance Metrics</h3>
                    <div class="advanced-stats">
                        <p>Normative Inflation: <span id="normative-inflation">Loading...</span></p>
                        <p>Temporal Gap: <span id="temporal-gap">Loading...</span></p>
                        <p>System Efficiency: <span id="system-efficiency">Loading...</span></p>
                    </div>
                </div>
                <div class="chart-box">
                    <h3>Correlation Analysis</h3>
                    <canvas id="correlationChart"></canvas>
                </div>
                <div class="chart-box">
                    <h3>Time Series Analysis</h3>
                    <canvas id="timeSeriesChart"></canvas>
                </div>
            </div>

            <!-- Detailed Statistics -->
            <div class="detailed-stats">
                <h3>Recent Activity</h3>
                <div class="activity-timeline" id="recent-activity">
                    <!-- Will be populated by JavaScript -->
                </div>
=======
                    <h3>System Trends</h3>
                    <canvas id="trendsChart"></canvas>
                </div>
>>>>>>> FastAPIversion
            </div>
        </div>
    </div>

<<<<<<< HEAD
    <style>
    .stats-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }

    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .stat-numbers {
        font-size: 1.2em;
    }

    .charts-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }

    .chart-box {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .activity-timeline {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-top: 20px;
    }

    .activity-item {
        padding: 10px;
        border-left: 3px solid #4CAF50;
        margin: 10px 0;
        background: #f9f9f9;
    }

    .correlation-stats {
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        margin-top: 10px;
    }

    .correlation-stats p {
        margin: 5px 0;
        font-size: 1.1em;
    }

    .correlation-stats span {
        font-weight: bold;
        color: #4CAF50;
    }
    </style>

    <script>
    // Function to update statistics
    async function updateStatistics() {
        try {
            // Fetch cases statistics
            const pendingResponse = await fetch('/api/get_pending_cases');
            const solvedResponse = await fetch('/api/get_solved_cases');
            const pendingData = await pendingResponse.json();
            const solvedData = await solvedResponse.json();

            // Update case counts
            document.getElementById('pending-count').textContent = pendingData.total_pending;
            document.getElementById('solved-count').textContent = solvedData.total_solved;
            document.getElementById('total-cases').textContent = 
                pendingData.total_pending + solvedData.total_solved;

            // Calculate and update resolution rate
            const totalCases = pendingData.total_pending + solvedData.total_solved;
            const resolutionRate = totalCases ? 
                ((solvedData.total_solved / totalCases) * 100).toFixed(1) : 0;
            document.getElementById('resolution-rate').textContent = `${resolutionRate}%`;

            // Fetch norms statistics
            const normsResponse = await fetch('/api/get_norms');
            const norms = await normsResponse.json();
            
            // Update norms counts
            const validNorms = norms.filter(norm => norm.valid).length;
            const invalidNorms = norms.filter(norm => !norm.valid).length;
            document.getElementById('valid-norms').textContent = validNorms;
            document.getElementById('invalid-norms').textContent = invalidNorms;
            document.getElementById('total-norms').textContent = norms.length;

            // Update charts
            updateCaseTypesChart(pendingData.pending_cases, solvedData.solved_cases);
            updateResolutionTimeline(solvedData.solved_cases);
            
            // Calculate correlations
            await calculateCorrelations([norms], [solvedData.solved_cases]);

            // Update trends chart
            await updateTrendsChart([norms], [solvedData.solved_cases]);

        } catch (error) {
            console.error('Error updating statistics:', error);
        }
    }

    // Function to update the case types chart
    function updateCaseTypesChart(pendingCases, solvedCases) {
        const ctx = document.getElementById('caseTypesChart').getContext('2d');
        
        // Count cases by type
        const caseTypes = {
            'Environmental Concern': 0,
            'Civil Rights Issue': 0,
            'Labor Dispute': 0,
            'Consumer Protection': 0,
            'Public Safety Concern': 0
        };

        [...pendingCases, ...solvedCases].forEach(caseItem => {
            Object.keys(caseTypes).forEach(type => {
                if (caseItem.text.includes(type)) {
                    caseTypes[type]++;
                }
            });
        });

        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: Object.keys(caseTypes),
                datasets: [{
                    data: Object.values(caseTypes),
                    backgroundColor: [
                        '#FF6384',
                        '#36A2EB',
                        '#FFCE56',
                        '#4BC0C0',
                        '#9966FF'
                    ]
=======
    <footer>
        © 2024 Optimus Interface - Enhancing Rule of Law through Systems Interaction
    </footer>

    <script>
    async function fetchStatistics() {
        try {
            const response = await fetch('/api/get_statistics');
            const data = await response.json();
    
            document.getElementById('pending-count').textContent = data.cases.pending || 0;
            document.getElementById('solved-count').textContent = data.cases.solved || 0;
            document.getElementById('total-cases').textContent = data.cases.total || 0;
            document.getElementById('valid-norms').textContent = data.norms.valid || 0;
            document.getElementById('invalid-norms').textContent = data.norms.invalid || 0;
            document.getElementById('total-norms').textContent = data.norms.total || 0;
    
            const resolutionRate = data.cases.total
                ? Math.round((data.cases.solved / data.cases.total) * 100)
                : 0;
            document.getElementById('resolution-rate').textContent = `${resolutionRate}%`;
    
            const solvedResponse = await fetch('/api/get_solved_cases');
            const solvedData = await solvedResponse.json();
    
            updateResolutionTimeline(solvedData.solved_cases || []);
            updateTrendsChart(data.cases.total, data.cases.solved, data.cases.pending);
            updateCaseTypesChart(data.cases.pending, data.cases.solved);
        } catch (error) {
            console.error('Error fetching statistics:', error);
        }
    }
    
    async function fetchNormativeInflation() {
        try {
            const response = await fetch('/api/get_normative_inflation');
            const data = await response.json();
    
            document.getElementById('normative-density').textContent = data.inflation_data.normative_density || 0;
            document.getElementById('processing-rate').textContent = data.inflation_data.processing_rate || 0;
            document.getElementById('backlog').textContent = data.inflation_data.backlog || 0;
            document.getElementById('temporal-gap').textContent = data.inflation_data.temporal_gap || "N/A";
    
        } catch (error) {
            console.error('Error fetching normative inflation metrics:', error);
        }
    }
    
    function updateCaseTypesChart(pending, solved) {
        const ctx = document.getElementById('caseTypesChart').getContext('2d');
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Pending Cases', 'Solved Cases'],
                datasets: [{
                    data: [pending, solved],
                    backgroundColor: ['#FFCE56', '#36A2EB']
>>>>>>> FastAPIversion
                }]
            }
        });
    }
<<<<<<< HEAD

    // Function to update the resolution timeline
    function updateResolutionTimeline(solvedCases) {
        const ctx = document.getElementById('resolutionTimelineChart').getContext('2d');
        
        // Clear any existing chart
        if (window.resolutionChart) {
            window.resolutionChart.destroy();
        }
        
        // Group cases by date
        const timelineData = {};
        const today = new Date();
        const last7Days = [...Array(7)].map((_, i) => {
            const date = new Date(today);
            date.setDate(date.getDate() - i);
            return date.toISOString().split('T')[0];
        }).reverse();

        // Initialize all dates with 0
        last7Days.forEach(date => {
            timelineData[date] = 0;
        });

        // Count cases for each date
        solvedCases.forEach(caseItem => {
            const date = caseItem.resolved_at.split('T')[0];
            if (timelineData.hasOwnProperty(date)) {
                timelineData[date]++;
            }
        });

        window.resolutionChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: last7Days,
                datasets: [{
                    label: 'Cases Resolved',
                    data: last7Days.map(date => timelineData[date] || 0),
=======
    
    function updateResolutionTimeline(solvedCases) {
        const ctx = document.getElementById('resolutionTimelineChart').getContext('2d');
    
        if (!Array.isArray(solvedCases) || solvedCases.length === 0) {
            console.warn("No solved cases data available for timeline.");
            return;
        }
    
        const resolutionData = {};
        solvedCases.forEach(caseItem => {
            if (caseItem.resolved_at) {
                const date = caseItem.resolved_at.split('T')[0];
                console.log("Processed date:", date);
                resolutionData[date] = (resolutionData[date] || 0) + 1;
            }
        });
        console.log("Resolution data:", resolutionData);
        const sortedDates = Object.keys(resolutionData).sort();
        const resolvedCounts = sortedDates.map(date => resolutionData[date]);
    
        if (window.resolutionChart) {
            window.resolutionChart.destroy();
        }
        console.log("Chart data:", sortedDates, resolvedCounts); 
        window.resolutionChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: sortedDates,
                datasets: [{
                    label: 'Cases Resolved Over Time',
                    data: resolvedCounts,
>>>>>>> FastAPIversion
                    borderColor: '#4CAF50',
                    backgroundColor: 'rgba(76, 175, 80, 0.1)',
                    tension: 0.1,
                    fill: true
                }]
            },
            options: {
<<<<<<< HEAD
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Date'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        callbacks: {
                            title: function(context) {
                                return `Date: ${context[0].label}`;
                            },
                            label: function(context) {
                                return `Cases Resolved: ${context.raw}`;
                            }
=======
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { stepSize: 1 }
                    },
                    x: {
                        title: { display: true, text: 'Date' }
                    }
                },
                plugins: {
                    legend: { display: true, position: 'top' },
                    tooltip: {
                        callbacks: {
                            title: context => `Date: ${context[0].label}`,
                            label: context => `Cases Resolved: ${context.raw}`
>>>>>>> FastAPIversion
                        }
                    }
                }
            }
        });
    }
<<<<<<< HEAD

    // Add these new functions
    async function calculateCorrelations(normsData, casesData) {
        // Use the lengths directly
        const normCounts = [normsData[0].length];
        const caseCounts = [casesData[0].length];
        
        // Calculate correlation using simple-statistics
        const correlation = normCounts[0] && caseCounts[0] ? 
            (normCounts[0] / (normCounts[0] + caseCounts[0])).toFixed(2) : 0;
        
        document.getElementById('norm-case-correlation').textContent = correlation;
        document.getElementById('resolution-rate-trend').textContent = 
            `${((caseCounts[0] / (normCounts[0] || 1)) * 100).toFixed(1)}%`;
    }

    async function updateTrendsChart(normsData, casesData) {
        const ctx = document.getElementById('trendsChart').getContext('2d');
        
        // Clear existing chart
        if (window.trendsChart) {
            window.trendsChart.destroy();
        }

        const timeLabels = ['Current State'];

        window.trendsChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: timeLabels,
                datasets: [
                    {
                        label: 'Norms Created',
                        data: [normsData[0].length],
                        borderColor: '#4CAF50',
                        tension: 0.1
                    },
                    {
                        label: 'Cases Processed',
                        data: [casesData[0].length],
                        borderColor: '#2196F3',
                        tension: 0.1
=======
    
    let trendsChartInstance;
    
    function updateTrendsChart(totalCases, solvedCases, pendingCases) {
        const ctx = document.getElementById('trendsChart').getContext('2d');
    
        if (trendsChartInstance) {
            trendsChartInstance.destroy();
        }
    
        trendsChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Cases Overview'],
                datasets: [
                    {
                        label: 'Total Cases',
                        data: [totalCases],
                        backgroundColor: '#FF6384'
                    },
                    {
                        label: 'Solved Cases',
                        data: [solvedCases],
                        backgroundColor: '#36A2EB'
                    },
                    {
                        label: 'Pending Cases',
                        data: [pendingCases],
                        backgroundColor: '#FFCE56'
>>>>>>> FastAPIversion
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
<<<<<<< HEAD
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'System Activity Over Time'
                    }
=======
>>>>>>> FastAPIversion
                }
            }
        });
    }
<<<<<<< HEAD

    // Update statistics every 30 seconds
    document.addEventListener('DOMContentLoaded', () => {
        updateStatistics();
        setInterval(updateStatistics, 30000);
    });
    </script>
</body>
</html> 
=======
    
    function openDialog() {
        const dialog = document.getElementById('math-dialog');
        dialog.style.display = 'block';
    
        if (window.MathJax) {
            MathJax.typesetPromise();
        }
    }
    
    function closeDialog() {
        document.getElementById('math-dialog').style.display = 'none';
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        fetchStatistics();
        fetchNormativeInflation();
    });
    
    setInterval(fetchStatistics, 30000);
    setInterval(fetchNormativeInflation, 30000);
    </script>

    <style>
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .chart-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

    /* ✅ Make the dialog scrollable, resizable, and properly positioned */
    .dialog {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        width: 50%;
        max-width: 600px;
        max-height: 80vh; /* ✅ Limit height so it's not too big */
        overflow-y: auto; /* ✅ Enable scrolling */
    }

    /* ✅ Ensure the dialog content is readable */
    .dialog-content {
        text-align: left;
        padding: 10px;
    }

    /* ✅ Make the close button visible */
    .close-button {
        float: right;
        font-size: 24px;
        cursor: pointer;
        margin-left: 10px;
    }

    .close-button:hover {
        color: red;
    }

    /* ✅ Allow clicking outside the dialog to close it */
    .dialog-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5); /* ✅ Semi-transparent background */
        z-index: 999;
    }
        
    </style>
</body>
</html>
>>>>>>> FastAPIversion
